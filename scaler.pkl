# Definisi Fitur dan Target
features = ['Feat_Return_1d', 'Feat_Close_Open', 'Feat_High_Low',
            'Feat_Dist_MA5', 'Feat_Vol_Change']

X = df[features]
y = df['Target_Return'] # Target kita sekarang adalah Return

# Split Data (80% Train, 20% Test) - Tanpa Shuffle (Time Series)
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, shuffle=False
)

# Simpan Log Harga Asli untuk Keperluan Evaluasi (Mengembalikan ke Rupiah)
# Kita butuh harga hari ini untuk menghitung: Harga_Besok = Harga_Hari_Ini * exp(Prediksi_Return)
test_dates = df.loc[X_test.index, 'timestamp']
test_price_today_log = df.loc[X_test.index, 'Close_Log']
test_price_next_actual = np.exp(df.loc[X_test.index, 'Close_Log'].shift(-1)) # Harga Asli Besok (Target Real)

# Scaling (Penting untuk SVR dan Linear Regression)
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled  = scaler.transform(X_test)

# Kembalikan ke DataFrame agar nama kolom aman
X_train_scaled = pd.DataFrame(X_train_scaled, columns=features)
X_test_scaled  = pd.DataFrame(X_test_scaled, columns=features)

print("Data berhasil di-split dan di-scaling.")
